# TODO APP

## Description
This is a simple todo app that allows you to add, delete and mark tasks as done.


## Database tips
To reset the database anytime

```bash
dropdb todoapp && createdb todoapp
```


## Migrations
Install Flask-Migrate dependencies:

  ```bash
  pip3 install Flask-Migrate
  ```

Import in app.py file.
Then, create an instance:

  ```python
  from flask_migrate import Migrate
  migrate = Migrate(app, db)
  ```

To create a migration:

  ```bash
  flask db init
  ```

It creates a migrations folder in the project root directory. This folder contain a version table and a migrations.

Before to create migration:

  ```bash
  dropdb todoapp && createdb todoapp
  ```

To create a migration:

  ```bash
  flask db migrate -m "migration message"
  #or without custom message
  flask db migrate
  ```


To apply the migration:

  ```bash
  flask db upgrade
  ```

To downgrade the migration:
  
  ```bash
  flask db downgrade
  ```

An example, we update `todo` table adding a new column.
We need to create a new migration:

  ```bash
  flask db migrate -m "Add  new column to todo table"
  ```

Then, apply the migration:

  ```bash
  flask db upgrade
  ```

## Working whith existing data

   ```bash
  flask db downgrade
  ```

The 'Completed' column (The new column) was deleted and now we insert new data.

Insert data into the database, we can use the following command:

  ```bash
  psql todoapp < data.sql
  ```
  Manually:

  ```sql
  INSERT INTO todos (description) VALUES ('This is todo');
  INSERT INTO todos (description) VALUES ('This is todo 2');
  INSERT INTO todos (description) VALUES ('This is todo 3');
```

If we run `flask db upgrade` again a not null violation error should be displayed, because we set as nullable=False the new column.
To fix this, we need to change the column to nullable=True (migration file) and then run `flask db upgrade`.

```python
def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('todos', schema=None) as batch_op:
        batch_op.add_column(sa.Column('completed', sa.Boolean(), nullable=True))
    # And add the following
        op.execute("UPDATE todos SET completed = False WHERE completed IS NULL")

        op.alter_column('todos', 'completed', nullable=False)
```

Then, run `flask db upgrade` again.